Расширение дискового пространства на Виртуальной машине
=======================================================

- Заходим в настройки виртуальной машины у которой хотим расширить дисковое пространство.
- Заходим в настройки дисков виртуальной машины в левом меню:

	Settings -> Disks

- Нажимаем на кнопку: + Add data disk
- В столбце Name таблицы с дисками открываем раскрывающийся список в котором выбираем: Create disk.
- В открывшемся окне Create managed disk пишем название нового диска, тип диска и размер. Нажимаем кнопку Create.

- Используя терминал заходим на расширяемую виртуальную машину через ssh.
- выполнив следующую команду получим список дисков подключенных к виртуальной машине:

.. code:: console

	 $ sudo fdisk -l

- из списка дисков найдем вновь добавленный(диск будет не "Партиционирован"). Скопируем путь к физическому диску (например: /dev/sdc).
 
- выполним следующую команду создадим раздел. Использование комнады gdisk позволяет добавлять диски с размером более 2ТБ.

.. code:: console

	 $ sudo gdisk /dev/sdc

- Консоль постребует ввода команды, введите: n

.. code:: console

	 Command (m for help): n

- Консоль попросит ввести номер раздела, введите число от 1 до 4: 1

.. code:: console
  
	 Partition number (1-4, default 1): 1

- После того как в консоли будет написано, что создан раздел, введите: w

.. code:: console

	 Command (m for help): w

- Далее консоль потребует ввести: y

.. code:: console

         Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
         PARTITIONS!!

         Do you want to proceed? (Y/N): y

**- Выполним форматирование добавленного раздела диска, для этого выполним команду:**

.. code:: console

	 sudo mkfs.ext4 /dev/sdc1

- После форматирования раздела необходимо подключить раздел, для этого нам нужно добавить раздел в список добавленных разделов, для этого выполним следующую команду:

.. code:: console
  
	 sudo vim /etc/fstab

откроется конфигурация, добавим еще одну строку и заполним ее:

.. code:: console

	 # CLOUD_IMG: This file was created/modified by the Cloud Image build process
	 UUID=3756934c-31d3-413c-8df9-5b7c7b1a4451       /        ext4   defaults,discard        0 0
	 UUID=B38E-A2BF  /boot/efi       vfat    defaults,discard        0 0
	 /dev/disk/cloud/azure_resource-part1    /mnt    auto    defaults,nofail,x-systemd.requires=cloud-init.service,comment=cloudconfig       0       2
	 /dev/sdc1	/home/nkrokhmal/storage 	auto 	defaults		0	0

Так как мы расширяли папку storage, то указали именно его во втором столбце.

- Для сохранения данных в из папки storage, переименуем его в storage1 выполнив команду:

.. code:: console

	 sudo mv storage/ storage1/

- Вновь создадим папку storage:

.. code:: console

	 sudo mkdir storage

- перезапустим Виртуальную машину:

.. code:: console

         sudo reboot

- После перезапуска проверим содержимое папки storage в ней должна появиться папка lost+found.
- В вновь созданную папку storage скопируем сохраненные файлы из папки storage1, выполнив следующую команду:

.. code:: console

	 sudo cp storage1/* storage -R

- после выполнения команды нужно проверить папку storage на наличие файлов.
- После копирования всех файлов папку storage1 можно удалить.

**Если при какой либо причине фтп стал недоступен и подключиться к нему через ssh не удается(к примеру после перезагрузки ftp)**

   Одно из возможных причин, это то что OS загрузилась не с того диска. 
   Для решения нужно сделать следующие действия:
   - Зайти на VM через консоль в личном кабинете виртуальной машины.
   - В Файле /etc/fstab закоментировать строку с диском расширения.
.. code:: console

      

.. code:: console

         sudo vim /etc/fstab
         
   - Перезагрузить VM. После этого виртуальная машина будет доступна по ssh.
   - Добавить диск расширения в файл /etc/fstab (раскомментировать строку с диском расширения).
Перезагрузить VM.
